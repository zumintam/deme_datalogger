# 1. Khai b√°o phi√™n b·∫£n CMake v√† T√™n Project
cmake_minimum_required(VERSION 3.10)
project(mb_master_service)

# 2. C·∫•u h√¨nh ti√™u chu·∫©n C++
set(CMAKE_CXX_STANDARD 11)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# 3. X√°c ƒë·ªãnh ƒë∆∞·ªùng d·∫´n ƒë·∫øn th∆∞ vi·ªán d√πng chung (dist_libs)
# C·∫•u tr√∫c: project_demo/services/mb_master -> l√πi 2 c·∫•p ƒë·ªÉ ra project_demo
get_filename_component(PROJECT_ROOT "${CMAKE_CURRENT_SOURCE_DIR}/../../" ABSOLUTE)
set(LIBS_DIR "${PROJECT_ROOT}/components/dist_libs")

message(STATUS "üöÄ Building MB_MASTER")
message(STATUS "üìÇ Linker Path: ${LIBS_DIR}")

# 4. Khai b√°o c√°c ƒë∆∞·ªùng d·∫´n Header (Include)
include_directories(
    "include"                         # Header n·ªôi b·ªô c·ªßa mb_master (n·∫øu c√≥)
    "${LIBS_DIR}/include"             # Header chung c·ªßa h·ªá th·ªëng
    "${LIBS_DIR}/include/modbus"      # Header th∆∞ vi·ªán libmodbus
)

# 5. Khai b√°o file th·ª±c thi v√† c√°c file ngu·ªìn (.cpp)
# B·∫°n n√™n li·ªát k√™ c√°c file .cpp c·∫ßn thi·∫øt cho module mb_master ·ªü ƒë√¢y
add_executable(mb_master 
    mb_master.cpp
    example.cpp
)

# 6. Link c√°c th∆∞ vi·ªán tƒ©nh (.a) v√† th∆∞ vi·ªán h·ªá th·ªëng
target_link_libraries(mb_master
    "${LIBS_DIR}/lib/libmodbus.a"      # Quan tr·ªçng nh·∫•t cho Modbus
    "${LIBS_DIR}/lib/libmeter_driver.a"
    "${LIBS_DIR}/lib/libzmq.a"         # N·∫øu b·∫°n d√πng ZeroMQ ƒë·ªÉ giao ti·∫øp gi·ªØa c√°c service
    "${LIBS_DIR}/lib/libcjson.a"       # N·∫øu b·∫°n c·∫ßn parse c·∫•u h√¨nh JSON
    pthread                            # Th∆∞ vi·ªán lu·ªìng (c·∫ßn cho std::mutex trong code c·ªßa b·∫°n)
    rt                                 # Real-time library cho Linux
    dl                                 # Dynamic link library (n·∫øu c·∫ßn)
)

# 7. T√πy ch·ªçn: Copy file th·ª±c thi ra th∆∞ m·ª•c build chung ho·∫∑c bin
# install(TARGETS mb_master DESTINATION ${PROJECT_ROOT}/bin)